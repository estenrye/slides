---
- name: Block packets that set both SYN and FIN tcp flags.
  ansible.builtin.iptables:
    table: filter
    chain: Bogus
    protocol: tcp
    jump: DROP
    wait: "{{ firewall_wait_lock_seconds }}"
    tcp_flags:
      flags:
        - SYN
        - FIN
      flags_set:
        - SYN
        - FIN
  become: true

- name: Block packets that set both SYN and RST tcp flags.
  ansible.builtin.iptables:
    table: filter
    chain: Bogus
    protocol: tcp
    jump: DROP
    wait: "{{ firewall_wait_lock_seconds }}"
    tcp_flags:
      flags:
        - SYN
        - RST
      flags_set:
        - SYN
        - RST
  become: true
  notify:
    - persist iptables

- name: Block packets from bogus internal subnets.
  ansible.builtin.iptables:
    table: filter
    chain: Bogus
    protocol: tcp
    jump: DROP
    source: "{{ item }}"
    wait: "{{ firewall_wait_lock_seconds }}"
  loop: "{{ firewall_bogus_inbound_subnets }}"
  become: true
  notify:
    - persist iptables

- name: Block packets from 127.0.0.0/8 not received on the loopback interface
  ansible.builtin.iptables:
    table: filter
    chain: Bogus
    protocol: tcp
    jump: DROP
    source: 127.0.0.0/8
    in_interface: "! lo"
    wait: "{{ firewall_wait_lock_seconds }}"
  become: true
  when: firewall_bogus_block_loopback_subnet
  notify:
    - persist iptables
